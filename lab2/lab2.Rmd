---
title: "lab2"
author: "Yakovlev Evgenii"
date: '20 ноября 2017 г '
output: html_document
---

#### Исходные данные

Установленная среда R включает в себя набор заранее сконфигурированных массивов данных. В данной лабораторной требуется использовать одну из них — датафрейм из 93 машин-новинок 1993 года. Для того, чтобы загрузить данный датафрейм, необходимо выполнить следующие команды:
```{r}
library(MASS)
data(Cars93)
```

Для того, чтобы ознакомиться со структурой и составом данных, можно выполнить команду View(Cars93) или нажать на соответствующую кнопку в RStudio.
```{r}
View(Cars93)
```

#### Задание 1

1. Выполните команду summary() на полном наборе данных. Можно ли по результату выполнения сказать сколько строк в датафрейме? Если да, напишите сколько. Если нет, то приведите другой способ.
```{r}
summary(Cars93)
```

По выходным данным команды можно определить количество строк в датафрейме. Всего получилось 93 строки. Так же можно воспользоваться командой str(Cars93), чтобы узнать количество строк и столбцов.

2. Найдите среднюю цену машин с задним приводом.
```{r}
Rear<-subset(Cars93,DriveTrain=='Rear')
Rear.mean<-mean(Rear[,5])
```

3. Найдите минимальное число лошадиных сил автомобиля для 7 пассажиров. Для 6 пассажиров.
```{r}
a<-subset(Cars93,Passengers=='7')# 7 пассажиров
a2<-min(a[,13])
b<-subset(Cars93,Passengers=='6')# 6 пассажиров
b2<-min(b[,13])
```

4. Найдите машины с максимальным, минимальным и средним(медианой) расстоянием, которая машина может проехать по трассе. Вам понадобятся 2 колонки, чтобы рассчитать расстояние. Какие?
```{r}
max.c<-subset(Cars93, MPG.highway == max(Cars93[,8]))
min.c<-subset(Cars93, MPG.highway == min(Cars93[,8]))
highway<-Cars93[,8]*Cars93[,17]# Максимальное расстояние, которое может пройти машина, колнки 8 и 17 (MPG.highway и Fuel.tank.capacity умножаются друг на друга) 
bind.Cars93=cbind(Cars93,highway)
highway.max<-subset(bind.Cars93, highway == max(highway)) 
highway.min<-subset(bind.Cars93, highway == min(highway)) 
highway.median<-subset(bind.Cars93, highway == median(highway))
```

#### Задание 2

В самом начале занятий приводился пример с фабрикой и производством автомобилей. Ниже приведён пример кода, который старается оптимизировать выпуск продукции ориентируясь на доступные ресурсы.
```{r}
factory.run <- function (o.cars=1, o.trucks=1) {
  factory <- matrix(c(40,1,60,3),nrow=2, dimnames=list(c("трудодни","сталь"),c("автомобили","грузовики")))
  warehouse <- c(1600,70) #Доступно материалов на складе
  names(warehouse) <- rownames(factory)
  reserve <- c(8,1)
  names(reserve) <- rownames(factory)
  output <- c(o.cars, o.trucks)
  names(output) <- colnames(factory)
  
  steps <- 0 # Счётчик числа шагов цикла
  repeat {
    steps <- steps + 1
    needed <- factory %*% output # Подсчитаем ресурсы, которые нам нужны для производства требуемого кол-ва машин
    message(steps)
    print(needed)
    # Если ресурсов достаточно и остаток меньше или равен резерву, то мы произвели максимум возможного.
    # Нужно прекращать
    if (all(needed <= warehouse) && all((warehouse - needed) <= reserve)) {
      break()
    }
    # Если заявка слишком большая и ресурсов недостаточно, уменьшим её на 10%
    if (all(needed > warehouse)) {
      output <- output * 0.9
      next()
    }
    # Если всё наоброт, то увеличим на 10%
    if (all(needed < warehouse)) {
      output <- output * 1.1
      next()
    }
    # Если мы потребили одного ресурса слишком много, а другого недостаточно,
    # то увеличим план на случайную величину
    output <- output * (1+runif(length(output),min=-0.1,max=0.1))
  }
  
  return(output)
}
```

1. Выполните код и запустите функцию ``factory.run()``.
```{r}
factory.run()
```

2. С какими входными значениями функция вызвана? Какой получился результат?
Функция factory.run() была вызвана со стандартными значениями. Изначально необходимо было изготовить одну машину и один грузовик. В результате выполнения каждого шага выводятся затрачиваемые ресурсы и № шага цикла. В результате функция возвращает количество автомобилей и грузовиков, которое выгодно выпустить.

3. Повторите вызов 4 раза. Полученные ответы отличаются от полученных ранее? Если да, почему? Если нет, почему?
```{r}
factory.run()
factory.run()
factory.run()
factory.run()
```

Результаты отличаются друг от друга т.к для оптимизации выпуска продукции используются случайные числа.

4. В приведённом коде, переменные _steps_ и _output_ находятся внутри алгоритма. Измените функцию так, чтобы она возвращала число шагов и произведённое количество машин.
```{r}
factory.run <- function (o.cars=1, o.trucks=1) {
  factory <- matrix(c(40,1,60,3),nrow=2, dimnames=list(c("трудодни","сталь"),c("автомобили","грузовики")))
  warehouse <- c(1600,70) #Доступно материалов на складе
  names(warehouse) <- rownames(factory)
  reserve <- c(8,1)
  names(reserve) <- rownames(factory)
  output <- c(o.cars, o.trucks)
  names(output) <- colnames(factory)
  
  steps <- 0 # Счётчик числа шагов цикла
  repeat {
    steps <- steps + 1
    needed <- factory %*% output # Подсчитаем ресурсы, которые нам нужны для производства требуемого кол-ва машин
    message(steps)
    print(needed)
    # Если ресурсов достаточно и остаток меньше или равен резерву, то мы произвели максимум возможного.
    # Нужно прекращать
    if (all(needed <= warehouse) && all((warehouse - needed) <= reserve)) {
      break()
    }
    # Если заявка слишком большая и ресурсов недостаточно, уменьшим её на 10%
    if (all(needed > warehouse)) {
      output <- output * 0.9
      next()
    }
    # Если всё наоброт, то увеличим на 10%
    if (all(needed < warehouse)) {
      output <- output * 1.1
      next()
    }
    # Если мы потребили одного ресурса слишком много, а другого недостаточно,
    # то увеличим план на случайную величину
    output <- output * (1+runif(length(output),min=-0.1,max=0.1))
  }
  print(needed)
  message(steps)
  return(trunc(output))
}

```

5. Установите план равный 30 автомобилям и 20 грузовикам и выполните функцию.
```{r}
factory.run(30, 20)
```
Итоговый запрос ресурсов получился равным 1597 трудодням и 69.76 тоннам стали. Для получения результата было пройдено 312 итераций.